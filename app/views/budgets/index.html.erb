<h1>Listing budgets</h1>
  <%= form_tag(budgets_path, :method => "get", id: "search-form") do %>
    <%= select_tag :search, options_for_select([ 
      "January", 
      "February", 
      "March", 
      "April", 
      "May", 
      "June",
      "July",
      "August",
      "September",
      "October",
      "November",
      "December"
      ], (params[:search] or Time.now.strftime("%B"))) %>
    <%= submit_tag "Search" %>
  <% end %>
<table>
  <thead>
    <tr>
      <th>Seller</th>
      <th>Month</th>
      <th>Amount</th>
      <th colspan="3">Actions</th>
    </tr>
  </thead>

  <tbody>
    <% @search_budgets.each do |budget| %>
      <tr>
        <td><%= empl(budget.user) %></td>
        <td><%= budget.month %></td>
        <td><%= budget.amount %></td>
        <td><%= link_to 'Show', budget %></td>
        <td><%= link_to 'Edit', edit_budget_path(budget) %></td>
        <td><%= link_to 'Destroy', budget, method: :delete, data: { confirm: 'Are you sure?' } %></td>
      </tr>
    <% end %>
  </tbody>
</table>
<br>

<table>
  <thead>
    <tr>
      <th>Seller</th>
      <th>Budget</th>
    </tr>
  </thead>
  <tbody>
    <% User.all.each do |user| %>
    <tr>
      <td><%= empl(user) %></td>
      <% if seller_budget(user, params[:search]) == 0 %>
      <td>
        <%= simple_form_for(@budget) do |f| %>
          <% if @budget.errors.any? %>
            <div id="error_explanation">
              <h2><%= pluralize(@budget.errors.count, "error") %> prohibited this budget from being saved:</h2>

              <ul>
              <% @budget.errors.full_messages.each do |message| %>
                <li><%= message %></li>
              <% end %>
              </ul>
            </div>
          <% end %>
            <%= f.hidden_field :user_id, :value => user.id %>
            <% if params[:search] %>
              <%= f.hidden_field :month, :value => params[:search] %>
            <% else %>
              <%= f.hidden_field :month, :value => Time.now.strftime("%B") %>
            <% end %>
            <%= f.input_field :amount %>
            <%= f.submit %>
          </div>
        <% end %>
      </td>
      <% else %>
      <td><%= seller_budget(user, params[:search]) %></td>
      <% end %>
    </tr>
    <% end %>
  </tbody>
</table>
<br />

<%= link_to 'New Budget', new_budget_path %>