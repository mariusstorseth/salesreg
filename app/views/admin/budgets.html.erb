<%= render 'menu' %>

  <%= form_tag(admin_budgets_path, :method => "get", id: "search-form") do %>
  <div class="row">
    <div class="col-md-offset-6 col-md-2">
      <%= select_tag :office, options_for_select([
        "All",
        "Oslo", 
        "Stockholm",
        "Jönköping"
        ]), :class => 'form-control' %>
    </div>
    <div class="col-md-2">
      <%= select_tag :search, options_for_select([ 
        "January",
        "February",
        "March",
        "April",
        "May",
        "June",
        "July",
        "August",
        "September",
        "October",
        "November",
        "December"
        ], (params[:search] or Time.now.strftime("%B"))), :class => 'form-control' %>
    </div>
    <div class="col-md-1">
      <%= select_tag :year, options_for_select([ 
        "2014",
        "2015"
        ]), :class => 'form-control' %>
    </div>
    <div class="col-md-1">
      <%= submit_tag "Choose", :class => "btn btn-default" %>
    </div>
  </div>
<% end %>

<div class="row">
  <div class="col-md-8">
    <div class="page-header border-none">
      <h3>Budgets by seller</h3>
    </div>

    <div class="table-responsive">
      <table class="table table-striped table-hover">
        <thead>
          <tr>
            <th>Seller</th>
            <th>Office</th>
            <th>Budget</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody>
          <% @users.each do |user| %>
          <tr>
            <td><%= empl(user) %></td>
            <td><%= user.office.name %></td>
            <% if seller_budget(user, params[:search]) == 0 %>
            <td>
              <%= simple_form_for(@budget) do |f| %>
                <% if @budget.errors.any? %>
                  <div id="error_explanation">
                    <h2><%= pluralize(@budget.errors.count, "error") %> prohibited this budget from being saved:</h2>

                    <ul>
                    <% @budget.errors.full_messages.each do |message| %>
                      <li><%= message %></li>
                    <% end %>
                    </ul>
                  </div>
                <% end %>
                  <%= f.hidden_field :user_id, :value => user.id %>
                  <% if params[:search] %>
                    <%= f.hidden_field :month, :value => params[:search] %>
                  <% else %>
                    <%= f.hidden_field :month, :value => Time.now.strftime("%B") %>
                  <% end %>
                  <%= f.input_field :amount, :class => "form-control input-sm" %>
                </td>
                <td>
                  <%= f.submit "Add", :class => "btn btn-primary btn-sm" %>
                </div>
              <% end %>
            </td>
            <% else %>
            <td><%= currency(seller_budget(user, params[:search])) %></td>
            <td><%= link_to "Edit", edit_budget_path(seller_budget_id(user, params[:search])) %></td>
            <% end %>
          </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  </div>

  <div class="col-md-4">
    <div class="page-header border-none">
      <h3>Budgets by office</h3>
    </div>
    <div class="table-responsive">
      <table class="table table-striped table-hover">
        <thead>
          <tr>
            <th>Office</th>
            <th>Budget</th>
          </tr>
        </thead>
        <tbody>
          <% @offices.each do |office| %>
          <tr>
            <td><%= link_to office.name, office_path(office) %></td>
            <td><%= currency(office_month_budget(office, params[:search])) %></td>
          </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  </div>
</div>